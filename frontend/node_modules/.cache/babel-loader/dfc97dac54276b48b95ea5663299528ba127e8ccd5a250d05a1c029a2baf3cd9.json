{"ast":null,"code":"import _slicedToArray from\"/Users/admin/Desktop/projects/wetop/taxi/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useRef,useState}from'react';import styles from'./OrdersHistory.module.scss';import cx from'classnames';import{useOnClickOutside}from'../../../helpers/hooks';import{ORDERS_NAMES}from'../../../helpers/dictionaries';import{fetchOrdersByPage}from'../../../services/orderService';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var OrdersHistory=function OrdersHistory(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isOpenOrders=_useState2[0],setIsOpenOrders=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),page=_useState6[0],setPage=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),prevPage=_useState8[0],setPrevPage=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),nextPage=_useState10[0],setNextPage=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),orders=_useState12[0],setOrders=_useState12[1];var ordersRef=useRef(null);var btnRef=useRef(null);// Call hook passing in the ref and a function to call on outside click\nuseOnClickOutside(ordersRef,btnRef,function(){return setIsOpenOrders(false);});var fetchOrderList=function fetchOrderList(page){setIsLoading(true);fetchOrdersByPage(page).then(function(data){setPrevPage(data===null||data===void 0?void 0:data.data.previous);setNextPage(data===null||data===void 0?void 0:data.data.next);setOrders(data===null||data===void 0?void 0:data.data.results);}).then(function(){return setIsLoading(false);}).catch(function(error){alert(error);});};var onClickOrdersHandler=function onClickOrdersHandler(){if(isOpenOrders){fetchOrderList();}setIsOpenOrders(!isOpenOrders);setPage(1);};useEffect(function(){fetchOrderList(page);},[page]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{ref:btnRef,className:cx(styles.btn,isOpenOrders?styles.active:''),onClick:onClickOrdersHandler,children:\"\\u0418\\u0441\\u0442\\u043E\\u0440\\u0438\\u044F \\u0437\\u0430\\u043A\\u0430\\u0437\\u043E\\u0432\"}),isOpenOrders&&/*#__PURE__*/_jsx(\"div\",{ref:ordersRef,className:styles.orders_popup,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.orders_list,children:[/*#__PURE__*/_jsx(\"table\",{children:/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:styles.orders_id,children:\"\\u041D\\u043E\\u043C\\u0435\\u0440 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0430\"}),/*#__PURE__*/_jsx(\"th\",{className:styles.orders_name,children:\"\\u0418\\u043C\\u044F \\u043A\\u043B\\u0438\\u0435\\u043D\\u0442\\u0430\"}),/*#__PURE__*/_jsx(\"th\",{className:styles.orders_phone,children:\"\\u0422\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D \\u043A\\u043B\\u0438\\u0435\\u043D\\u0442\\u0430\"}),/*#__PURE__*/_jsx(\"th\",{className:styles.orders_status,children:\"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0430\"})]})})}),/*#__PURE__*/_jsx(\"div\",{className:styles.orders_list_scroll,children:/*#__PURE__*/_jsx(\"table\",{children:/*#__PURE__*/_jsxs(\"tbody\",{children:[isLoading?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{children:\"\\u0414\\u0430\\u043D\\u043D\\u044B\\u0435 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0436\\u0430\\u044E\\u0442\\u0441\\u044F\"})}):orders.map(function(orderItem,index){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:styles.orders_id,children:orderItem.id}),/*#__PURE__*/_jsx(\"td\",{className:styles.orders_name,children:orderItem.name}),/*#__PURE__*/_jsx(\"td\",{className:styles.orders_phone,children:orderItem.phone}),/*#__PURE__*/_jsx(\"td\",{className:styles.orders_status,children:ORDERS_NAMES[orderItem.status]})]},index);}),/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsxs(\"td\",{className:styles.btns,colSpan:4,children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setPage(page-1);},disabled:!prevPage,children:\"\\u041F\\u0440\\u0435\\u0434\\u044B\\u0434\\u0443\\u0449\\u0430\\u044F \\u0441\\u0442\\u0440\\u0430\\u043D\\u0438\\u0446\\u0430\"}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setPage(page+1);},disabled:!nextPage,children:\"\\u0421\\u043B\\u0435\\u0434\\u0443\\u044E\\u0449\\u0430\\u044F \\u0441\\u0442\\u0440\\u0430\\u043D\\u0438\\u0446\\u0430\"})]})})]})})})]})})]});};export default OrdersHistory;","map":{"version":3,"names":["React","useEffect","useRef","useState","styles","cx","useOnClickOutside","ORDERS_NAMES","fetchOrdersByPage","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","OrdersHistory","_useState","_useState2","_slicedToArray","isOpenOrders","setIsOpenOrders","_useState3","_useState4","isLoading","setIsLoading","_useState5","_useState6","page","setPage","_useState7","_useState8","prevPage","setPrevPage","_useState9","_useState10","nextPage","setNextPage","_useState11","_useState12","orders","setOrders","ordersRef","btnRef","fetchOrderList","then","data","previous","next","results","catch","error","alert","onClickOrdersHandler","children","ref","className","btn","active","onClick","orders_popup","orders_list","orders_id","orders_name","orders_phone","orders_status","orders_list_scroll","map","orderItem","index","id","name","phone","status","btns","colSpan","disabled"],"sources":["/Users/admin/Desktop/projects/wetop/taxi/frontend/src/pages/Dispatcher/OrdersHistory/OrdersHistory.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport styles from './OrdersHistory.module.scss';\nimport cx from 'classnames';\nimport { useOnClickOutside } from '../../../helpers/hooks';\nimport { ORDERS_NAMES } from '../../../helpers/dictionaries';\nimport { fetchOrdersByPage } from '../../../services/orderService';\n\nconst OrdersHistory = () => {\n  const [isOpenOrders, setIsOpenOrders] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [page, setPage] = useState(1);\n  const [prevPage, setPrevPage] = useState(null);\n  const [nextPage, setNextPage] = useState(null);\n  const [orders, setOrders] = useState([]);\n\n  const ordersRef = useRef(null);\n  const btnRef = useRef(null);\n\n  // Call hook passing in the ref and a function to call on outside click\n  useOnClickOutside(ordersRef, btnRef, () => setIsOpenOrders(false));\n\n  const fetchOrderList = (page) => {\n    setIsLoading(true);\n\n    fetchOrdersByPage(page)\n      .then((data) => {\n        setPrevPage(data?.data.previous);\n        setNextPage(data?.data.next);\n        setOrders(data?.data.results);\n      })\n      .then(() => setIsLoading(false))\n      .catch((error) => {\n        alert(error);\n      });\n  };\n\n  const onClickOrdersHandler = () => {\n    if (isOpenOrders) {\n      fetchOrderList();\n    }\n    setIsOpenOrders(!isOpenOrders);\n    setPage(1);\n  };\n\n  useEffect(() => {\n    fetchOrderList(page);\n  }, [page]);\n\n  return (\n    <>\n      <button\n        ref={btnRef}\n        className={cx(styles.btn, isOpenOrders ? styles.active : '')}\n        onClick={onClickOrdersHandler}>\n        История заказов\n      </button>\n      {isOpenOrders && (\n        <div ref={ordersRef} className={styles.orders_popup}>\n          <div className={styles.orders_list}>\n            <table>\n              <thead>\n                <tr>\n                  <th className={styles.orders_id}>Номер заказа</th>\n                  <th className={styles.orders_name}>Имя клиента</th>\n                  <th className={styles.orders_phone}>Телефон клиента</th>\n                  <th className={styles.orders_status}>Статус заказа</th>\n                </tr>\n              </thead>\n            </table>\n            <div className={styles.orders_list_scroll}>\n              <table>\n                <tbody>\n                  {isLoading ? (\n                    <tr>\n                      <td>Данные загружаются</td>\n                    </tr>\n                  ) : (\n                    orders.map((orderItem, index) => (\n                      <tr key={index}>\n                        <td className={styles.orders_id}>{orderItem.id}</td>\n                        <td className={styles.orders_name}>{orderItem.name}</td>\n                        <td className={styles.orders_phone}>\n                          {orderItem.phone}\n                        </td>\n                        <td className={styles.orders_status}>\n                          {ORDERS_NAMES[orderItem.status]}\n                        </td>\n                      </tr>\n                    ))\n                  )}\n                  <tr>\n                    <td className={styles.btns} colSpan={4}>\n                      <button\n                        onClick={() => setPage(page - 1)}\n                        disabled={!prevPage}>\n                        Предыдущая страница\n                      </button>\n                      <button\n                        onClick={() => setPage(page + 1)}\n                        disabled={!nextPage}>\n                        Следующая страница\n                      </button>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default OrdersHistory;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}